expressAdminApp.controller("reportController",["$scope","$window","reportService",function(a,b,c){a.reportPlaceHolder="loading",a.reportData={},a.reportList=[],a.parameters=[],a.collection=[],a.currentRpt="",a.totalSeats=0,a.totalFee=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,a.totalApplicableRefund=0,a.totalSeats=0,a.totalConfirmedSeats=0,a.totalCancelledSeats=0,a.totalFare=0,a.selectedDepot="",a.totalConfirmedSltbFee=0,a.totalConfirmedSltbFare=0,a.totalConfirmedExpressFee=0,a.totalConfirmedTransaction=0,a.totalCancelledSltbFee=0,a.totalCancelledSltbFare=0,a.totalCancelledExpressFee=0,a.totalCancelledTransaction=0,c.getReportList().then(function(a){}),c.getSupplierList().then(function(b){a.supplierList=b,a.supplierListPlaceHolder="select"}),a.$watchCollection("reportData.report",function(b,c){b&&(a.parameters=b.parameters)}),a.$watchCollection("form",function(b,c){b&&(a.collection=[],"expInv"===a.currentRpt&&a.loadExpInvReport(),"approvedRefund"===a.currentRpt&&a.loadApprovedRefundReport(),"cashReconReport"===a.currentRpt&&a.loadCashReconReport(),"dailyCashReconReport"===a.currentRpt&&a.loadDailyCashReconReport(),"futureResReport"===a.currentRpt&&a.loadFutureResReport(),"busFareReport"===a.currentRpt&&a.loadBusFareReport(),"busFeeReport"===a.currentRpt&&a.loadBusFeeReport(),"counterCashRecon"===a.currentRpt&&a.loadCounterCashReconReport())},!0),a.$watchCollection("collection",function(b,c){if(b!==c&&b){if("expInv"===a.currentRpt)for(a.totalSeats=0,a.totalFee=0,i=0;i<a.collection.length;i++)a.totalSeats+=a.collection[i].numberSeats,a.totalFee+=a.collection[i].totalExpressFee;if("approvedRefund"===a.currentRpt||"approvedRefundV2"===a.currentRpt)for(a.totalSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,a.totalApplicableRefund=0,i=0;i<a.collection.length;i++)a.totalSeats+=a.collection[i].numberSeats,a.totalFare+=parseFloat(a.collection[i].fare),a.totalSltbFee+=parseFloat(a.collection[i].sltbBookingFee),a.totalExpressFee+=parseFloat(a.collection[i].expressBookingFee),a.totalTransaction+=parseFloat(a.collection[i].transactionTotal),a.totalApplicableRefund+=parseFloat(a.collection[i].applicableRefund);if("cashReconReport"===a.currentRpt)for(a.totalSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=Number(a.collection[i].fare),a.totalSltbFee+=Number(a.collection[i].sltbBookingFee),a.totalExpressFee+=Number(a.collection[i].expressBookingFee),a.totalTransaction+=Number(a.collection[i].transactionTotal);if("dailyCashReconReport"===a.currentRpt)for(a.totalSeats=0,a.totalConfirmedSeats=0,a.totalCancelledSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,a.totalConfirmedSltbFee=0,a.totalConfirmedSltbFare=0,a.totalConfirmedExpressFee=0,a.totalConfirmedTransaction=0,a.totalCancelledSltbFee=0,a.totalCancelledSltbFare=0,a.totalCancelledExpressFee=0,a.totalCancelledTransaction=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=Number(a.collection[i].fare),a.totalSltbFee+=Number(a.collection[i].sltbBookingFee),a.totalExpressFee+=Number(a.collection[i].expressBookingFee),a.totalTransaction+=Number(a.collection[i].transactionTotal),a.totalConfirmedSltbFee+=Number(a.collection[i].confirmedSltbBookingFee),a.totalConfirmedSltbFare+=Number(a.collection[i].confirmedBookingFare),a.totalConfirmedExpressFee+=Number(a.collection[i].confirmedExpressBookingFee),a.totalConfirmedTransaction+=Number(a.collection[i].confirmedSltbBookingFee+a.collection[i].confirmedBookingFare+a.collection[i].confirmedExpressBookingFee),a.totalCancelledSltbFee+=Number(a.collection[i].cancelledSltbBookingFee),a.totalCancelledSltbFare+=Number(a.collection[i].cancelledBookingFare),a.totalCancelledExpressFee+=Number(a.collection[i].cancelledExpressBookingFee),a.totalCancelledTransaction+=Number(a.collection[i].cancelledSltbBookingFee+a.collection[i].cancelledBookingFare+a.collection[i].cancelledExpressBookingFee),a.totalConfirmedSeats+=Number(a.collection[i].confirmedBooking),a.totalCancelledSeats+=Number(a.collection[i].cancelledBooking);if("dailyCashReconReportV2"===a.currentRpt)for(a.totalSeats=0,a.totalCancelledSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,a.totoalNetPayable=0,a.totalCancelledSltbFee=0,a.totalCancelledSltbFare=0,a.totalCancelledExpressFee=0,a.totalCancelledTransaction=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=Number(a.collection[i].fare),a.totalSltbFee+=Number(a.collection[i].sltbBookingFee),a.totalExpressFee+=Number(a.collection[i].expressBookingFee),a.totalTransaction+=Number(a.collection[i].transactionTotal),a.totalCancelledSltbFee+=Number(a.collection[i].cxSltbBookingFee),a.totalCancelledSltbFare+=Number(a.collection[i].cxFare),a.totalCancelledExpressFee+=Number(a.collection[i].cxExpressBookingFee),a.totalCancelledTransaction+=Number(a.collection[i].cxApplicableRefund),a.totoalNetPayable+=Number(a.collection[i].netPayable),a.totalCancelledSeats+=Number(a.collection[i].cxNumberSeats);if("futureResReport"===a.currentRpt)for(a.totalSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=Number(a.collection[i].fare),a.totalSltbFee+=Number(a.collection[i].sltbBookingFee),a.totalExpressFee+=Number(a.collection[i].expressBookingFee),a.totalTransaction+=Number(a.collection[i].transactionTotal);if("busFareReport"===a.currentRpt)for(a.totalFare=0,a.totalSeats=0,i=0;i<a.collection.length;i++)a.totalFare+=Number(a.collection[i].totalFare),a.totalSeats+=Number(a.collection[i].numberSeats);if("busFeeReport"===a.currentRpt)for(a.totalSeats=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats);if("counterCashRecon"===a.currentRpt)for(a.totalSeats=0,a.totalFare=0,a.totalSltbFee=0,a.totalExpressFee=0,a.totalTransaction=0,i=0;i<a.collection.length;i++)a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=Number(a.collection[i].fare),a.totalSltbFee+=Number(a.collection[i].sltbBookingFee),a.totalExpressFee+=Number(a.collection[i].expressBookingFee),a.totalTransaction+=Number(a.collection[i].transactionTotal);if("depotBusFareReport"===a.currentRpt)for(a.totalSeats=0,a.totalFare=0,a.selectedDepot="",i=0;i<a.collection.length;i++)a.selectedDepot=a.collection[i].depot,a.totalSeats+=Number(a.collection[i].numberSeats),a.totalFare+=parseFloat(a.collection[i].totalFare)}},!0),a.loadExpInvReport=function(){a.loading=!0,c.getExpInvList(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="expInv",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadApprovedRefundReport=function(){a.loading=!0,c.getApprovedRefundReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="approvedRefund",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadApprovedRefundV2Report=function(){a.loading=!0,c.getApprovedRefundV2Report(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="approvedRefundV2",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadCashReconReport=function(){a.loading=!0,c.getCashReconReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="cashReconReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadDailyCashReconReport=function(){a.loading=!0,c.getDailyCashReconReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="dailyCashReconReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadDailyCashReconV2Report=function(){a.loading=!0,c.getDailyCashReconV2Report(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="dailyCashReconReportV2",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadFutureResReport=function(){a.loading=!0,c.getFutureResReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="futureResReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadBusFareReport=function(){a.loading=!0,c.getBusFareReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="busFareReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadBusFeeReport=function(){a.loading=!0,c.getBusFareReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="busFeeReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadCounterCashReconReport=function(){a.loading=!0,c.getCounterCashReconReport(a.form.from).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="counterCashRecon",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.loadDepotBusFareReport=function(){a.loading=!0,c.getDepotBusFareReport(a.form.from,a.form.supplierList).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.currentRpt="depotBusFareReport",a.collection=b),a.loading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})}}]),expressAdminApp.config(["$stateProvider",function(a){a.state("reports",{parent:"main",url:"/reports",templateUrl:"/admin-panel/report/"}),a.state("expInv",{parent:"main",url:"/expInv",templateUrl:"/admin-panel/report/expinvoice"}),a.state("approvedRefunds",{parent:"main",url:"/approvedRefunds",templateUrl:"/admin-panel/report/approvedRefunds"}),a.state("approvedRefundsV2",{parent:"main",url:"/approvedRefundsV2",templateUrl:"/admin-panel/report/approvedRefundsV2"}),a.state("futureReservationReport",{parent:"main",url:"/futureReservationReport",templateUrl:"/admin-panel/report/futureReservationReport"}),a.state("dailyCashReconciliation",{parent:"main",url:"/dailyCashReconciliation",templateUrl:"/admin-panel/report/dailyCashReconciliation"}),a.state("dailyCashReconciliationV2",{parent:"main",url:"/dailyCashReconciliationV2",templateUrl:"/admin-panel/report/dailyCashReconciliationV2"}),a.state("cashReconciliation",{parent:"main",url:"/cashReconciliation",templateUrl:"/admin-panel/report/cashReconciliation"}),a.state("operatedBusFare",{parent:"main",url:"/operatedBusFare",templateUrl:"/admin-panel/report/operatedBusFare"}),a.state("operatedBusFee",{parent:"main",url:"/operatedBusFee",templateUrl:"/admin-panel/report/operatedBusFee"}),a.state("ticketCounterReconciliation",{parent:"main",url:"/ticketCounterReconciliation",templateUrl:"/admin-panel/report/ticketCounterReconciliation"}),a.state("depotOperatedBusFare",{parent:"main",url:"/depotOperatedBusFare",templateUrl:"/admin-panel/report/depotOperatedBusFare"})}]),expressAdminApp.service("reportService",["$http","$q","$window",function(a,b,c){function d(){var b=a.post("/admin-panel/report/getreportlist");return b.then(q,p)}function e(){var b=a.post("/admin-panel/report/getsupplierlist");return b.then(q,p)}function f(b){var c=a.post("/admin-panel/report/expinvoiceList",{from:b});return c.then(q,p)}function g(b){var c=a.post("/admin-panel/report/approvedrefundsList",{from:b});return c.then(q,p)}function h(b){var c=a.post("/admin-panel/report/approvedrefundsV2List",{from:b});return c.then(q,p)}function i(b){var c=a.post("/admin-panel/report/cashreconList",{from:b});return c.then(q,p)}function j(b){var c=a.post("/admin-panel/report/dailycashreconList",{from:b});return c.then(q,p)}function k(b){var c=a.post("/admin-panel/report/dailycashreconV2List",{from:b});return c.then(q,p)}function l(b){var c=a.post("/admin-panel/report/futureresList",{from:b});return c.then(q,p)}function m(b){var c=a.post("/admin-panel/report/busfareList",{from:b});return c.then(q,p)}function n(b){var c=a.post("/admin-panel/report/ticketCounterReconciliationList",{from:b});return c.then(q,p)}function o(b,c){var d=a.post("/admin-panel/report/depotBusfareList",{from:b,supplier:c});return d.then(q,p)}function p(a){return angular.isObject(a.data)&&a.data.error?b.reject(a.data.error):b.reject("An unknown error occurred.")}function q(a){return a.data.hasOwnProperty("error")?b.reject(a.data.error):a.data}return{getReportList:d,getSupplierList:e,getExpInvList:f,getApprovedRefundReport:g,getApprovedRefundV2Report:h,getCashReconReport:i,getDailyCashReconReport:j,getDailyCashReconV2Report:k,getFutureResReport:l,getBusFareReport:m,getCounterCashReconReport:n,getDepotBusFareReport:o}}]);