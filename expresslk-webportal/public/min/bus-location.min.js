expressAdminApp.config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyCjCcLUvFOVw4kfwfxRnISAxtTrQb3zz5c",libraries:"weather,geometry,visualization"})}]),expressAdminApp.controller("loadBusLocation",["$scope","busLocationService","uiGmapGoogleMapApi","$timeout",function(a,b,c,d){a.busList=[],a.currentBus={bus:[]},a.mapDefaults={center:{latitude:6.933874,longitude:79.855397},zoom:15,refresh:!1},a.currentLocation={},a.marker={options:{icon:"/img/icons/bus/bus-location-pin.png",draggable:!1,labelContent:"Label",labelAnchor:"100 0",labelClass:"marker-labels"},events:{click:function(a,b,c){}}},a.locations=[],a.startDate=moment().subtract(1,"days").toDate(),a.endDate=!1,a.polyline={},a.error=!1,a.locLoading=!1;b.getBusList().then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):a.busList=b.bus},function(b){a.Global.error.hasError=!0,a.Global.error.message=b}),a.loadBusLocations=function(){a.error=!1,a.locLoading=!0,a.currentBus.bus&&b.getBusLocations(a.currentBus.bus.id,a.startDate,a.endDate).then(function(b){b.error?a.error=b.error:b.locations&&b.locations.length>0?c.then(function(){a.currentLocation=b.current,a.locations=b.locations,a.mapDefaults.center.latitude=a.currentLocation.latitude,a.mapDefaults.center.longitude=a.currentLocation.longitude,a.mapDefaults.refresh=!0}):a.error="No location data.",a.locLoading=!1},function(b){a.Global.error.hasError=!0,a.Global.error.message=b,a.locLoading=!1})},a.toggleLiveLocation=function(){moment(a.endDate).isValid()?a.endDate=!1:a.endDate=moment().toDate()},c.then(function(){a.polyline={stroke:{color:"#6060FB",weight:5},editable:!1,clickable:!1,draggable:!1,geodesic:!0,visible:!0,icons:[{icon:{path:google.maps.SymbolPath.BACKWARD_OPEN_ARROW},offset:"50px",repeat:"90px"}]}})}]),expressAdminApp.config(["$stateProvider",function(a){a.state("bus-location",{parent:"main",url:"/bus-location",templateUrl:"/admin-panel/bus/locationview",controller:"loadBusLocation"})}]),expressAdminApp.service("busLocationService",["$http","$q",function(a,b){function c(){var b=a.post("/admin-panel/bus/loadlocationbuslist",{});return b.then(f,e)}function d(b,c,d){var g=a.post("/admin-panel/bus/getlocations",{busId:b,fromDate:c,toDate:d});return g.then(f,e)}function e(a){return angular.isObject(a.data)&&a.data.error?b.reject(a.data.error):b.reject("An unknown error occurred.")}function f(a){return a.data.hasOwnProperty("error"),a.data}return{getBusList:c,getBusLocations:d}}]);