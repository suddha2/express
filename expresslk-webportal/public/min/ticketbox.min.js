expressAdminApp.controller("ticketboxSeatBooking",["$scope","$rootScope","$window","busService","payHelperService","$interval","$expConfirm",function(a,b,c,d,e,f,g){function h(){a.bookingData={passenger:[],contact:{},boardingLocation:a.boardingLocations[0],dropoffLocation:a.dropoffLocations[0],remarks:"",alertCustomer:!0,warrantPassRef:null,warrantPass:null},a.mySeatCheck=0,a.options={},a.errors={},a.onClickTab(a.tabs[0]),a.passengerAsContact=!1,a.booking_form.$setPristine(),a.hasWarrant=!1,a.hasPass=!1,b.$broadcast("reloadSeats")}a.bookingData={passenger:[],contact:{},boardingLocation:null,dropoffLocation:null,remarks:"",alertCustomer:!0,warrantPassRef:null,warrantPass:null,payment:{}},a.errors={},a.options={},a.today=new Date,a.passengerAsContact=!1,a.printReceipt=!0,a.boardingLocations=[],a.dropoffLocations=[],a.genderRequired=!1,a.personRequired=!0,a.agentData=[],a.mySeatCheck=0,a.hasWarrant=!1,a.hasPass=!1,a.tabs=[];var i=function(b){a.tabs.push({title:b.title+" (BBK)",url:b.url,type:b.type,vendor:!1,active:!1})},j={title:"Cash",url:"tab-cash",type:"Cash",vendor:!0,active:!1};ACL.fragmentCanExecute(Fragment.Name.payMethodCash)&&a.tabs.push(j),ACL.fragmentCanExecute(Fragment.Name.payMethodCashBBK)&&i(j),ACL.fragmentCanExecute(Fragment.Name.payMethodEzCash)&&a.tabs.push({title:"eZ Cash",url:"tab-ezCash",type:"ezCash",vendor:!0,active:!1});var k={title:"eZ Cash Ref",url:"tab-ezCash-ref",type:"ezCashRef",vendor:!0,active:!1};ACL.fragmentCanExecute(Fragment.Name.payMethodEzCashRef)&&a.tabs.push(k),ACL.fragmentCanExecute(Fragment.Name.payMethodEzCashBBK)&&i(k),ACL.fragmentCanExecute(Fragment.Name.payMethodMCash)&&a.tabs.push({title:"mCash",url:"tab-mCash",type:"mCash",vendor:!0,active:!1});var l={title:"Agents",url:"tab-agents",type:"agents",vendor:!0,active:!1};ACL.fragmentCanExecute(Fragment.Name.payMethodAgent)&&a.tabs.push(l),ACL.fragmentCanExecute(Fragment.Name.payMethodAgentBBK)&&i(l),ACL.fragmentCanExecute(Fragment.Name.payMethodPayAtBus)&&a.tabs.push({title:"Pay at Bus",url:"tab-atBus",type:"AtBus",vendor:!0,active:!1}),ACL.fragmentCanExecute(Fragment.Name.payMethodPayLater)&&a.tabs.push({title:"Pay Later",url:"tab-diifpay",type:"diifPay",vendor:!0,active:!1});var m={title:"Credit Card",url:"tab-credit",type:"Card",vendor:!0,active:!1};ACL.fragmentCanExecute(Fragment.Name.payMethodCard)&&a.tabs.push(m),ACL.fragmentCanExecute(Fragment.Name.payMethodCardBBK)&&i(m);var n={title:"Bank Transfer",url:"tab-banktransfer",type:"BankTr",vendor:!0,active:!1};ACL.fragmentCanExecute(Fragment.Name.payMethodBankTransfer)&&a.tabs.push(n),ACL.fragmentCanExecute(Fragment.Name.payMethodBankTransferBBK)&&i(n),a.onClickTab=function(b){a.bookingData.type=b.type,a.bookingData.vendor=!b.hasOwnProperty("vendor")||b.vendor;for(var c in a.tabs)a.tabs[c]===b?a.tabs[c].active=!0:a.tabs[c].active=!1},a.onClickTab(a.tabs[0]),e.getAgents().then(function(b){a.agentData=b}),a.$watch("hasWarrant",function(b,c){a.bookingData.warrantPass="",a.bookingData.warrantPassRef="",b&&(a.hasPass=!1,a.bookingData.warrantPass="warrant")}),a.$watch("hasPass",function(b,c){a.bookingData.warrantPass="",a.bookingData.warrantPassRef="",b&&(a.hasWarrant=!1,a.bookingData.warrantPass="pass")}),a.$watch("bookingData.warrantPassRef",function(b,c){b?a.$emit("bookingHasWarrantsOrPasses",!0):a.$emit("bookingHasWarrantsOrPasses",!1)}),a.$watchCollection("selected.seatNos",function(b,c){if(b&&a.bookingData.passenger){var d=a.bookingData.passenger;for(var e in d)$.inArray(d[e].seatNo,a.selected.seatNos)<0&&(a.bookingData.passenger=jQuery.grep(a.bookingData.passenger,function(a){return a.seatNo!=d[e].seatNo}))}});var o,p=function(a){var b=960,d=500;return c.open("/admin-panel/ticketbox/printticket?data="+a,"Ticket","status=no,width="+b+",height="+d+",top="+(screen.height/2-d/2)+",left="+(screen.width/2-b/2)+",toolbar=no,menubar=no,scrollbars=no,location=no"),c},q=function(a,b,d){var e=angular.element(c),g=e.width()-e.width()/8,h=e.height()-e.height()/8,i=c.open("about:blank","Ticket","status=no,width="+g+",height="+h+",top="+(e.height()/2-h/2)+",left="+(e.width()/2-g/2)+",toolbar=no,menubar=no,scrollbars=yes,location=no");return i.document.write('<html><head></head><body style="background: url(/img/preloader/Preloader_9.gif) no-repeat center; padding: 50px;">'+a+"</body></html>"),i.document.forms[0].submit(),r(),o=f(function(){i.closed&&(r(),d.apply(this,[!1]))},500),i.ipgResponse=function(a){r(),d.apply(this,[a]),i.close()},i},r=function(){angular.isDefined(o)&&(f.cancel(o),o=void 0)};a.$on("$destroy",function(){r()}),a.$on("showSeats",function(b,c){a.bookingData.passenger=[],a.bookingData.contact={},a.options={},a.onClickTab(a.tabs[0]),a.boardingLocations=c.boardingLocations,a.bookingData.boardingLocation=a.boardingLocations[0],a.dropoffLocations=c.dropoffLocations,a.bookingData.dropoffLocation=a.dropoffLocations[0],a.genderRequired=c.genderRequired,a.personRequired=c.personRequired}),a.placeBooking=function(c){if(a.errors={passenger:!1,contactData:!1},!a.bookingData.passenger||a.bookingData.passenger.length<1)return void(a.errors.passenger=!0);if(""===$.trim(a.bookingData.contact.mobileNo)&&""==$.trim(a.bookingData.contact.nic)&&""==$.trim(a.bookingData.contact.name))return void(a.errors.contactData=!0);var e=d.getSelectedBus();return e?void g({text:'Click "OK" to save.',title:"Save the booking?"}).then(function(){a.Global.loading=!0;var c=e.sectors[0].fromCityId,f=e.sectors[0].toCityId,g=e.resultIndex,i=a.bookingData,j=b.session;d.confirmBooking(c,f,g,i,j).then(function(b){if(b.error)a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b.error;else if("submitForm"==b.IPGtype){var c=b.IPGForm,d=b.reference;q(c,d,function(){a.Global.loading=!1,h()})}else{if(a.printReceipt){p(b.ticketData)}a.Global.loading=!1,a.Global.success.isSuccess=!0,a.Global.success.message="Seats booked successfully.",h()}},function(b){a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b})}):(a.Global.error.hasError=!0,void(a.Global.error.message="Unknown error occurred. Please refresh the web page."))};var s=function(b){a.bookingData.passenger[b]&&(a.bookingData.passenger[b].nic=a.bookingData.contact.nic,a.bookingData.passenger[b].name=a.bookingData.contact.name,a.bookingData.passenger[b].mobileNo=a.bookingData.contact.mobileNo)};a.$watchCollection("bookingData.contact",function(b,c){null!==a.mySeatCheck&&s(a.mySeatCheck)}),a.$watch("mySeatCheck",function(b,c){if(b!==c&&null!==c){var d=c;a.bookingData.passenger[d]&&(a.bookingData.passenger[d].nic="",a.bookingData.passenger[d].name="",a.bookingData.passenger[d].mobileNo="")}null!==b&&s(b)})}]),expressAdminApp.controller("ticketboxSchedule",["$scope","$http","$stateParams","ngTableParams","$rootScope","$location","$state","busService","cityDestinationService","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(b){a.destinations=l,a.destinationPlaceHolder="loading",a.searchFormData.end=null,i.getDestinationForCity(b).then(function(b){if(b.error)a.Global.error.hasError=!0,a.Global.error.message=b.error;else if(a.destinations=b.destinations,0==b.destinations.length?a.destinationPlaceHolder="empty":a.destinationPlaceHolder="select",c.to){for(var d=null,e=0;e<a.destinations.length;e++)if(a.destinations[e].id==c.to){d=a.destinations[e];break}d&&(a.searchFormData.end=d)}j.cancel(m),a.destinationsLoading=!1},function(){j.cancel(m),a.destinationsLoading=!1,a.Global.error.hasError=!0,a.Global.error.message="Network error occurred. May be your connection is too slow. Please try again."})}a.loading=!1,a.hasData=!1,a.searchFormData={},a.searchFormData.date=c.date,a.scheduleIndex=!1;var l=[],m=null;a.destinations=[],a.cityList=[],a.departuresLoading=!0,a.destinationsLoading=!1,a.destinationPlaceHolder="select",a.formTitle=!1,a.formTitleIsOpen=!0,i.getCityList().then(function(b){if(a.cityList=b,a.departuresLoading=!1,c.from){for(var d=null,e=0;e<a.cityList.length;e++)if(a.cityList[e].id==c.from){d=a.cityList[e];break}d&&(a.searchFormData.start=d)}}),a.$watchCollection("searchFormData.start",function(a,b){a&&""!==a&&k(a.id)});var n=new Date;ACL.fragmentCanExecute(Fragment.Name.ticketBoxHistory)&&(n=(new Date).setYear(n.getYear()-2)),a.minDate=n,a.maxDate=(new Date).setMonth((new Date).getMonth()+2),a.opened=!1,a.openCal=function(b){a.opened=!a.opened},a.dateOptions={showWeeks:"false"},a.submitSearch=function(){if(a.searchFormData&&a.searchFormData.start&&a.searchFormData.end&&a.searchFormData.date){var b=a.searchFormData.start.id,d=a.searchFormData.end.id,e=new Date(a.searchFormData.date),f=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2);b==c.from&&d==c.to&&f==c.date?g.transitionTo(g.current,c,{reload:!0,inherit:!1,notify:!0}):g.go("choose",{from:b,to:d,date:f,page:1})}};var o=[],p=function(b){b.date&&b.from&&b.to&&(a.loading=!0,h.getTicketSchedule(b.from,b.to,b.date,b.page).then(function(b){if(a.loading=!1,b.result){var c=b.result.oneway;e.session=b.session,o=c,0==c.length&&(a.formTitleIsOpen=!0),a.hasData=0!==c.length,a.tableParams&&a.tableParams.reload()}else a.Global.error.hasError=!0,a.Global.error.message=b.error},function(b){a.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b}))};a.tableParams=new d({page:c.page?c.page:1,count:5},{total:0,getData:function(a,b){b.total(o.length),a.resolve(o.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),p(c),a.goToPage=function(a){g.transitionTo("choose",{from:c.from,to:c.to,date:c.date,page:a})},a.viewSeats=function(b,c){h.setSelectedBus(c);var d=c.sectors[0].busRoute,f=d.boardingStops,g=d.dropStops;e.$broadcast("showSeats",{boardingLocations:f,dropoffLocations:g,busType:b.bus.busTypeId,scheduleId:b.scheduleId,busId:b.bus.id,seatPrice:c.prices,journeyData:{fromName:b.fromCityName,toName:b.toCityName,busPlate:b.bus.plateNumber,busName:b.bus.name,departure:b.departureTime},genderRequired:c.sectors[0].busRoute.genderRequired}),a.scheduleIndex=c.resultIndex}}]),expressAdminApp.controller("ticketboxSeatReport",["$scope","busService","$rootScope","$http",function(a,b,c,d){a.printSeats=function(a,b){var d=b.sectors[0].busRoute,e=d.boardingStops,f=d.dropStops,g={boardingLocation:e[0].id,dropoffLocation:f[0].id,busType:a.bus.busTypeId,scheduleId:a.scheduleId,bus:b.sectors[0].bus.plateNumber,session:c.session},h="/admin-panel/ticketbox-ajax/seatreport?";for(var i in g)h=h+"&"+i+"="+g[i];window.open(h)},a.sendCondaSms=function(b,e){if(confirm("Send Booking summary to conductor?")){a.Global.loading=!0;var f=e.sectors[0].busRoute,g=f.boardingStops,h=f.dropStops,i=d.post("/admin-panel/ticketbox-ajax/alertconda",{boardingLocation:g[0].id,dropoffLocation:h[0].id,busType:b.bus.busTypeId,scheduleId:b.scheduleId,bus:e.sectors[0].bus.plateNumber,session:c.session});i.then(function(b){b.data.error?(a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b.data.error):(a.Global.loading=!1,a.Global.success.isSuccess=!0,a.Global.success.message="message sent successfully.")},function(){var b;b=angular.isObject(response.data)&&response.data.error?response.data.error:"An unknown error occurred.",a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b})}}}]),expressAdminApp.controller("ticketboxSeatSelection",["$scope","$location","$rootScope","$stateParams","busService","$anchorScroll","payHelperService",function(a,b,c,d,e,f,g){var h=function(){a.seatInfo={},a.selected={seats:[],seatNos:[],amount:0,baseMarkups:0,baseDiscount:0,baseTax:0,baseCharges:0,total:0,busId:0,seatPassengerType:[]},a.journeyData={},a.loaded=!1,a.seatPrice=!1,a.totX=0,a.totY=0,a.gridY=[]};a.agentInfo=[],a.availableAgents=[],a.selectedBookingRef=null,a.hasWarrantOrPass=!1,a.warrantPassDeductAmount=0;var j={};h(),a.$on("bookingHasWarrantsOrPasses",function(b,c){a.hasWarrantOrPass=c,a.computeTicketTotal()}),g.getAgents().then(function(b){for(var c in b)a.agentInfo[b[c].id]=b[c]});var k=function(d,g,h,i,j){a.Global.loading=!0,e.getSeatInfo(d,g,h,i,c.session).then(function(c){if(c.result){var d=c.result,e=40,g=0,h=0;for(var i in d.seats){var k=d.seats[i],l=k.x*e,m=k.y*e,n="";if(k.agentDefault&&a.agentInfo[k.agentDefault]){var o=a.agentInfo[k.agentDefault];n="outline-color: "+o.color+";",a.availableAgents[o.id]=o}d.seats[i].style="right: "+m+"px; top: "+l+"px; ",d.seats[i].agent_style=n,g=k.x>g?k.x:g,h=k.y>h?k.y:h,k.dummy&&(d.seats[i].booked=!1,delete d.seats[i].dummy);var p=k.x*e;$.inArray(p,a.gridY)===-1&&a.gridY.push(p)}a.totX=(h+1)*e,a.totY=(g+1)*e,a.seatInfo=d.seats,a.gridY.sort(function(a,b){return a-b}),a.loaded=!0,console.log("scroll is set to "+j),j?(b.hash("seat-selection"),f()):(b.hash("page-top"),f())}else a.Global.error.hasError=!0,a.Global.error.message=c.error;a.Global.loading=!1},function(b){a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b})};a.setPassengerType=function(b,c){var d=a.selected.seatNos[b];for(i=0;i<a.selected.seatPassengerType.length;i++)if(a.selected.seatPassengerType[i].seat==d){a.selected.seatPassengerType[i].type=c;break}a.computeTicketTotal()},a.computeTicketTotal=function(){for(a.selected.amount=0,a.selected.baseMarkups=0,a.selected.baseDiscount=0,a.selected.baseTax=0,a.selected.baseCharges=0,a.warrantPassDeductAmount=0,a.selected.total=0,i=0;i<a.selected.seatPassengerType.length;i++)a.selected.baseMarkups+=parseFloat(a.seatPrice.baseMarkups),a.selected.baseDiscount+=parseFloat(a.seatPrice.baseDiscount),a.selected.baseTax+=parseFloat(a.seatPrice.baseTax),a.selected.baseCharges+=parseFloat(a.seatPrice.baseCharges),"Child"===a.selected.seatPassengerType[i].type?(a.selected.amount+=parseFloat(a.seatPrice.childFare),a.selected.total+=parseFloat(a.seatPrice.childFare)+parseFloat(a.seatPrice.baseMarkups)+parseFloat(a.seatPrice.baseDiscount)+parseFloat(a.seatPrice.baseTax)+parseFloat(a.seatPrice.baseCharges)):(a.selected.amount+=parseFloat(a.seatPrice.fare),a.selected.total+=parseFloat(a.seatPrice.fare)+parseFloat(a.seatPrice.baseMarkups)+parseFloat(a.seatPrice.baseDiscount)+parseFloat(a.seatPrice.baseTax)+parseFloat(a.seatPrice.baseCharges));a.hasWarrantOrPass&&(a.warrantPassDeductAmount=a.selected.amount,a.selected.total-=a.warrantPassDeductAmount)},a.chooseSeat=function(b,c){var d=$(c.target).closest("div");if(b.available!==!0||b.booked===!0)return void(a.selectedBookingRef=b.booking_ref);var e=a.selected.seats.indexOf(b.id);if(e>-1)a.Global.error.hasError=!1,a.selected.seats.splice(e,1),a.selected.seatNos.splice(e,1),a.selected.seatPassengerType.splice(e,1),a.computeTicketTotal(),d.removeClass("seat-selected");else{if(a.selected.seats.length>8)return a.Global.error.hasError=!0,void(a.Global.error.message="You are not allowed to book so many seats :-)");a.selected.seats.push(b.id),a.selected.seatNos.push(b.number),a.selected.seatPassengerType.push({seat:b.number,type:"A"}),a.computeTicketTotal(),d.addClass("seat-selected")}},a.$on("showSeats",function(b,c){j=c,h(),k.apply(this,[c.boardingLocations[0].id,c.dropoffLocations[0].id,c.busType,c.scheduleId,!0]),a.selected.busId=c.busId,a.seatPrice=c.seatPrice,a.journeyData=c.journeyData}),a.$on("reloadSeats",function(){h(),k.apply(this,[j.boardingLocations[0].id,j.dropoffLocations[0].id,j.busType,j.scheduleId,!1]),a.selected.busId=j.busId,a.seatPrice=j.seatPrice,a.journeyData=j.journeyData})}]),expressAdminApp.controller("ticketCancellation",["$scope","cancellationService",function(a,b){a.bookingRef="",a.bookingData=null,a.cancellationCharge=0,a.loading=!1,a.cancel={},a.getInfo=function(){a.loading=!0,b.getBookingDetails(a.bookingRef).then(function(b){b.error?(a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.bookingData=b.booking,a.cancellationCharge=b.cancellationCharge,a.refundAmount=b.refundAmount),a.loading=!1},function(b){a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b,a.loading=!1})},a.cancelAndRefund=function(c){a.Global.loading=!0,b.cancelBooking(c,a.cancel).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.resetForms(),a.Global.success.isSuccess=!0,a.Global.success.message="Booking has been cancelled."),a.Global.loading=!1},function(b){a.Global.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b})},a.resetForms=function(){a.bookingRef="",a.bookingData=null,a.cancellationCharge=0,a.loading=!1,a.cancel={},a.getbookingform.$setPristine(),a.getbookingform.$setUntouched(),a.cancelform.$setPristine(),a.cancelform.$setUntouched()}}]),expressAdminApp.controller("subBookingPay",["$scope",function(a){a.diffPayMaxDate=new Date,a.$watchCollection("journeyData",function(b,c){b&&(a.diffPayMaxDate=moment(a.journeyData.departure).subtract(1,"days"))})}]),expressAdminApp.controller("subBookingPopOver",["$scope","$uibModal",function(a,b){a.showBookingDetails=function(c){var d=b.open({animation:!0,templateUrl:"bookking_model",controller:"bookingModalInstanceCtrl",size:"lg",appendTo:"body",windowClass:"popup fullscreen-popup",resolve:{items:function(){return{bookingId:c}}}});d.result.then(function(b){a.bookingId=c},function(){})}}]),expressAdminApp.controller("bookingModalInstanceCtrl",["$scope","$uibModalInstance","items","$sce",function(a,b,c,d){a.popupUrl="/index.php/admin-panel/?type=min#/booking/edit/"+c.bookingId,a.ok=function(){b.dismiss("cancel")}}]),expressAdminApp.directive("cancelBooking",["$uibModal",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=b.$eval(d.cancelBooking);c.on("click",function(){var c=a.open({animation:!0,templateUrl:"cancellation_model",controller:"cancellationModalInstanceCtrl",size:"lg",appendTo:"body",windowClass:"popup",resolve:{items:function(){return{bookingId:e}}}});c.result.then(function(a){b.reference=e},function(){})})}}}]),expressAdminApp.controller("cancellationModalInstanceCtrl",["$scope","cancellationService","$rootScope","$uibModalInstance","items",function(a,b,c,d,e){a.bookingData=null,a.errors=null,a.reference=e.bookingId,a.cancel={hasRefund:!1},a.loading=!0,b.getBookingDetails(a.reference).then(function(b){b.error?a.errors=b.error:a.bookingData=b.booking,a.loading=!1},function(b){a.loading=!1,a.errors=b}),a.cancelBooking=function(){confirm("Are you sure to cancel this booking?")&&(a.loading=!0,b.cancelBooking(a.reference,a.cancel).then(function(b){b.error?(a.Global.error.hasError=!0,a.Global.error.message=b.error):(a.resetForms(),a.Global.success.isSuccess=!0,a.Global.success.message="Booking has been cancelled.",c.$broadcast("reloadSeats"),a.ok()),a.loading=!1},function(b){a.loading=!1,a.Global.error.hasError=!0,a.Global.error.message=b}))},a.resetForms=function(){a.bookingRef="",a.bookingData=null,a.cancellationCharge=0,a.loading=!1,a.cancel={hasRefund:!1},a.cancelform.$setPristine(),a.cancelform.$setUntouched()},a.ok=function(){d.dismiss("cancel")}}]),expressAdminApp.directive("stickyholder",["$window",function(a){return{link:function(a,b,c){var d=$('<div style="width: 100%;"></div>');d.prependTo("body"),a.$watch(c.hideSticky,function(a){a?(b.addClass("hidden"),d.hide()):(b.removeClass("hidden"),d.show().height(b.outerHeight()))}),a.$on("$destroy",function(){d.remove()})}}}]),expressAdminApp.config(["$stateProvider",function(a){a.state("schedule",{parent:"main",url:"/schedule",templateUrl:"ticketbox_template"}).state("choose",{parent:"main",url:"/schedule/:from/:to/:date/:page/",templateUrl:"ticketbox_template"}).state("cancellation",{parent:"main",url:"/ticket-cancellation",templateUrl:"/admin-panel/ticketbox/cancellation"})}]),expressAdminApp.service("busService",["$http","$q",function(a,b){function c(b,c,d,e){var f=a.post("/admin-panel/ticketbox-ajax/displayschedule",{from:b,to:c,date:d,page:e});return f.then(j,i)}function d(b,c,d,e,f){var g=a.post("/admin-panel/ticketbox-ajax/seatinfo",{boardingLocation:b,dropoffLocation:c,busType:d,scheduleId:e,session:f});return g.then(j,i)}function e(b,c,d,e,f){var g=a.post("/admin-panel/ticketbox-ajax/placebooking",{session:f,fromCity:b,toCity:c,resultIndex:d,bookingData:e});return g.then(j,i)}function f(b){var c=a.post("/admin-panel/ticketbox-ajax/releaseholded",{reference:b});return c.then(j,i)}function g(a){k=a}function h(){return k}function i(a){return angular.isObject(a.data)&&a.data.error?b.reject(a.data.error):b.reject("An unknown error occurred.")}function j(a){return a.data.hasOwnProperty("error"),a.data}var k=!1;return{getTicketSchedule:c,getSeatInfo:d,confirmBooking:e,setSelectedBus:g,getSelectedBus:h,releaseHeldBooking:f}}]),expressAdminApp.service("cancellationService",["$http","$q",function(a,b){function c(b){var c=a.post("/admin-panel/ticketbox/cancelbooking",{ref:b,mode:"getBooking"});return c.then(f,e)}function d(b,c){var d=a.post("/admin-panel/ticketbox/cancelbooking",{ref:b,data:c,mode:"cancelBooking"});return d.then(f,e)}function e(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function f(a){return a.data.hasOwnProperty("error"),a.data}return{getBookingDetails:c,cancelBooking:d}}]),expressAdminApp.service("cityDestinationService",["$http","$q","$injector","$timeout",function(a,b,c,d){function e(b){var c=a.post("/admin-panel/ticketbox-ajax/getdestinations",{cityId:b});return c.then(h,g)}function f(){var b=a.post("/admin-panel/ticketbox-ajax/getcities");return b.then(h,g)}function g(a){return angular.isObject(a.data)&&a.data.message?b.reject(a.data.message):b.reject("An unknown error occurred.")}function h(a){return a.data.hasOwnProperty("error"),a.data}return{getDestinationForCity:e,getCityList:f}}]),expressAdminApp.service("payHelperService",["$http","$q",function(a,b){this._agents=!1,this.getAgents=function(){var c=b.defer();if(this._agents)c.resolve(this._agents);else{var d=a.post("/admin-panel/ticketbox-ajax/getagents",{});d.then(function(a){a.data.hasOwnProperty("error")&&c.reject("An unknown error occurred."),this._agents=a.data,c.resolve(a.data)},function(a){angular.isObject(a.data)&&a.data.error?c.reject(a.data.error):c.reject("An unknown error occurred.")})}return c.promise}}]);